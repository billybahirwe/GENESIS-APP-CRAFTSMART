extends ../layout

block append head
  link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css')

block content
  .container
    .dashboard-header
      h1.dashboard-title Customer Reports
      p.dashboard-subtitle View and manage reports submitted by employers.
    
    .dashboard-section
      if reports && reports.length > 0
        table.table.table-striped
          thead
            tr
              th Report Subject
              th Craftsman Reported
              th Submitted By
              th Date
              th Actions
          tbody
            each report in reports
              tr
                td= report.reportSubject
                td= report.craftsmanName
                td= report.employerId
                td= report.timestamp.toLocaleDateString()
                td
                  button.btn.btn-sm.btn-info(data-bs-toggle="modal", data-bs-target="#reportModal", data-report=JSON.stringify(report)) View Details
      else
        .empty-state
          .empty-icon
            i.fas.fa-inbox
          h3 No New Reports
          p You're all caught up! There are no new reports from employers.

    // Modal for viewing full report
    #reportModal.modal.fade(tabindex="-1", aria-labelledby="reportModalLabel", aria-hidden="true")
      .modal-dialog
        .modal-content
          .modal-header
            h5#reportModalLabel.modal-title Report Details
            button.btn-close(type="button", data-bs-dismiss="modal", aria-label="Close")
          .modal-body
            p
              strong Subject: 
              span#modalSubject
            p
              strong Craftsman Name: 
              span#modalCraftsmanName
            p
              strong Submitted by Employer ID: 
              span#modalEmployerId
            p
              strong Date Submitted: 
              span#modalDate
            hr
            h6 Report Message:
            p#modalMessage
          .modal-footer
            button.btn.btn-secondary(type="button", data-bs-dismiss="modal") Close
            
block append scripts
  script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
  script.
    document.addEventListener('DOMContentLoaded', () => {
      const reportModal = document.getElementById('reportModal');
      reportModal.addEventListener('show.bs.modal', (event) => {
        const button = event.relatedTarget;
        const report = JSON.parse(button.getAttribute('data-report'));
        
        document.getElementById('modalSubject').textContent = report.reportSubject;
        document.getElementById('modalCraftsmanName').textContent = report.craftsmanName;
        document.getElementById('modalEmployerId').textContent = report.employerId;
        document.getElementById('modalDate').textContent = new Date(report.timestamp).toLocaleDateString();
        document.getElementById('modalMessage').textContent = report.reportMessage;
      });
    });
