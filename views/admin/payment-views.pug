// views/payment-records.pug
extends layout

block content
  .container.mx-auto.p-6
    h1.text-3xl.font-bold.mb-6.text-gray-800 Admin Payment Dashboard

    // Section for Transfer-In Records
    div.mb-8
      h2.text-2xl.font-semibold.mb-4.text-green-700 Incoming Transfers
      if transferInRecords && transferInRecords.length > 0
        .overflow-x-auto.bg-white.shadow.rounded-lg
          table.min-w-full.divide-y.divide-gray-200.table-auto
            thead.bg-gray-100
              tr
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Transaction ID
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase From User
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Amount (UGX)
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Status
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Transfer Time
            tbody.bg-white.divide-y.divide-gray-200
              each record in transferInRecords
                tr
                  td.px-6.py-4.whitespace-nowrap.text-sm.font-medium.text-gray-900= record.transactionId
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500= record.userId || 'N/A'
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-green-600= record.total_amount.toLocaleString('en-UG')
                  td.px-6.py-4.whitespace-nowrap.text-sm.
                    span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full(class=record.status === 'COMPLETED' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800')= record.status
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500= record.createdAt.toLocaleDateString() + ' at ' + record.createdAt.toLocaleTimeString()
      else
        p.text-gray-500.text-center No incoming transfer records found.

    // Section for Transfer-Out Records
    div.mb-8
      h2.text-2xl.font-semibold.mb-4.text-red-700 Outgoing Transfers
      if transferOutRecords && transferOutRecords.length > 0
        .overflow-x-auto.bg-white.shadow.rounded-lg
          table.min-w-full.divide-y.divide-gray-200.table-auto
            thead.bg-gray-100
              tr
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Transaction ID
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase To User
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Amount (UGX)
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Status
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Transfer Time
            tbody.bg-white.divide-y.divide-gray-200
              each record in transferOutRecords
                tr
                  td.px-6.py-4.whitespace-nowrap.text-sm.font-medium.text-gray-900= record.transactionId
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500= record.craftsmanId || 'N/A'
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-red-600= record.disbursement_amount.toLocaleString('en-UG')
                  td.px-6.py-4.whitespace-nowrap.text-sm.
                    span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full(class=record.status === 'DISBURSEMENT_COMPLETED' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')= record.status
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500= record.createdAt.toLocaleDateString() + ' at ' + record.createdAt.toLocaleTimeString()
      else
        p.text-gray-500.text-center No outgoing transfer records found.

    // Section for All Payment Logs
    div
      h2.text-2xl.font-semibold.mb-4.text-gray-700 All Payment Logs
      if allLogs && allLogs.length > 0
        .overflow-x-auto.bg-white.shadow.rounded-lg
          table.min-w-full.divide-y.divide-gray-200.table-auto
            thead.bg-gray-100
              tr
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Log ID
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Transaction ID
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Action
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Status
                th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Timestamp
            tbody.bg-white.divide-y.divide-gray-200
              each log in allLogs
                tr
                  td.px-6.py-4.whitespace-nowrap.text-sm.font-medium.text-gray-900= log._id
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500= log.transactionId
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500= log.action
                  td.px-6.py-4.whitespace-nowrap.text-sm.
                    span.px-2.inline-flex.text-xs.leading-5.font-semibold.rounded-full(class=log.status === 'COMPLETED' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800')= log.status
                  td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-500= log.createdAt.toLocaleString()
      else
        p.text-gray-500.text-center No payment logs found.
