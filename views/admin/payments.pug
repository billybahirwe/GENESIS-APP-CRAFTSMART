extends ../layout

block append head
  link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css')
  style.
    .payments-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .payments-table th, .payments-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    .payments-table th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: bold;
      color: white;
      text-transform: uppercase;
    }
    .status-SUCCESSFUL { background-color: #4CAF50; }
    .status-PROCESSING { background-color: #FFC107; }
    .status-DISBURSEMENT_INITIATED { background-color: #2196F3; }
    .status-COMPLETED { background-color: #4CAF50; }
    .status-FAILED { background-color: #F44336; }

block content
  .container
    .dashboard-header
      h1.dashboard-title Manage All Payments
      p.dashboard-subtitle View and track all platform transactions
    
    if transactions && transactions.length > 0
      table.payments-table
        thead
          tr
            th Transaction ID
            th Case ID
            th Employer Phone
            th Amount
            th Status
            th Date
            th Actions
        tbody
          each tx in transactions
            tr
              td= tx.transaction_id.substring(0, 12) + '...'
              td= tx.case_id
              td= tx.employer_phone
              td= formatCurrency(tx.total_amount)
              td
                span.status-badge(class=`status-${tx.status}`)
                  if tx.status === 'SUCCESSFUL'
                    | Paid by Employer
                  else if tx.status === 'DISBURSEMENT_INITIATED'
                    | Paying Craftsman
                  else if tx.status === 'COMPLETED'
                    | Completed
                  else
                    | #{tx.status}
              td= formatDate(tx.created_at)
              td
                a.btn.btn-info.btn-sm(href=`/admin/transaction/${tx.transaction_id}`) View Details
                //- Optional: A manual trigger for disbursement in case of a bug
                if tx.status === 'SUCCESSFUL'
                  button.btn.btn-sm.btn-success.disburse-btn(data-tx-id=tx.transaction_id) Release Funds
    else
      .empty-state
        .empty-icon
          i.fas.fa-credit-card
        h3 No Transactions Found
        p All payment records are up to date