doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title CraftSmart - Craftsman Outsourcing Platform
    link(rel="stylesheet", href="/css/style.css")
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    script(src="https://cdn.jsdelivr.net/npm/chart.js")
    block head

  body(class=(path === '/' ? 'homepage' : '') data-user-id=user ? user._id : '')
    header.header
      .container
        .header-content
          .logo
            a(href="/")
              i.fas.fa-hammer(style="color:#374151;margin-right:6px;")
              | CraftSmart
          
          nav.nav(id="nav")
            .profile-section
              if user
                .profile-info
                  a(href=`/${user.role}/profile`)
                    if user.profilePicture
                      img.profile-avatar(src=user.profilePicture, alt="Profile Picture")
                    else
                      .profile-initial-placeholder 
                        i.fas.fa-user(style="color:#374151;")
                    .profile-details
                      span.profile-name #{user.name}
              else
                .profile-info
                  .profile-initial-placeholder
                    i.fas.fa-user(style="color:#374151;")

            ul.nav-list
              if user
                li
                  a(href=`/${user.role}/dashboard`)
                    i.fas.fa-gauge(style="color:#374151;")
                    span Dashboard
                if user.role === 'employer'
                  li
                    a(href="/employer/post-job")
                      i.fas.fa-briefcase(style="color:#374151;")
                      span Post Job
                  li
                    a(href="/employer/browse-craftsmen")
                      i.fas.fa-users-gear(style="color:#374151;")
                      span Browse Craftsmen
                if user.role === 'admin'
                  li
                    a(href="/admin/blacklist")
                      i.fas.fa-user-shield(style="color:#374151;")
                      span Admin Blacklist
                if user.role === 'craftsman'
                  li.mobile-only
                    a(href="/craftsman/profile")
                      i.fas.fa-id-card(style="color:#374151;")
                      span My Profile
                li
                  a(href="/public-blacklist")
                    i.fas.fa-ban(style="color:#374151;")
                    span Public Blacklist
                li.mobile-only
                  a(href="/logout")
                    i.fas.fa-right-from-bracket(style="color:#374151;")
                    span Logout
              else
                li
                  a(href="/login")
                    i.fas.fa-right-to-bracket(style="color:#374151;")
                    span Login
                li
                  a(href="/register")
                    i.fas.fa-user-plus(style="color:#374151;")
                    span Register
                li
                  a(href="/contact")
                    i.fas.fa-envelope(style="color:#374151;")
                    span Contact Us

          .header-icons
            if user
              a.nav-icon.notification-link(href="#")
                i.fas.fa-bell(style="color:#374151;")
                span#notification-badge.notification-badge 0
              a.nav-icon.messages-link(href="/messages")
                i.fas.fa-envelope(style="color:#374151;")
              .profile-dropdown
                a.nav-icon.profile-icon(href="#", onclick="toggleDropdown(event)")
                  i.fas.fa-user-circle(style="color:#374151;")
                .profile-dropdown-content#profileDropdown
                  a(href=`/${user.role}/profile`)
                    i.fas.fa-user.mr-2(style="color:#374151;")
                    | My Profile
                  a(href="/contact")
                    i.fas.fa-envelope.mr-2(style="color:#374151;")
                    | Contact Us
                  a(href="/logout")
                    i.fas.fa-right-from-bracket.mr-2(style="color:#374151;")
                    | Logout

          .mobile-menu-toggle(onclick="toggleMobileMenu()")
            span
            span
            span

    main.main
      block content

    footer.footer
      .container
        p &copy; 2025 CraftSmart. All rights reserved.

    // Socket.io and custom JS
    script(src="/socket.io/socket.io.js")
    script(src="/js/scripts.js")

    // ⚡ Block for child template scripts
    block scripts

    // Inline layout JS
    script.
      console.log("✅ layout.pug JS loaded"); // debug to verify scripts load

      function toggleDropdown(event) {
        event.stopPropagation();
        const dropdown = document.getElementById("profileDropdown");
        if (dropdown) dropdown.classList.toggle("show");
      }
      
      window.onclick = function(event) {
        if (!event.target.matches('.profile-icon i')) {
          var dropdowns = document.getElementsByClassName("profile-dropdown-content");
          for (var i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('show')) {
              openDropdown.classList.remove('show');
            }
          }
        }
      }

      function toggleMobileMenu() {
        const nav = document.getElementById('nav');
        if (nav) nav.classList.toggle('nav-active');
      }
