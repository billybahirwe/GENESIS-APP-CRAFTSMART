extends ../layout

block content
  .container
    .dashboard-header
      h1.dashboard-title Welcome back, #{user.name}
      p.dashboard-subtitle Manage your projects and find skilled craftsmen
    
    .dashboard-stats
      .stat-card
        .stat-icon üìã
        .stat-info
          .stat-number= jobs.length
          .stat-label Active Jobs
      .stat-card
        .stat-icon üë®‚Äçüîß
        .stat-info
          .stat-number= craftsmen.length
          .stat-label Available Craftsmen
      .stat-card
        .stat-icon üí∞
        .stat-info
          .stat-number UGX #{jobs.reduce((sum, job) => sum + job.budget, 0).toLocaleString('en-UG', { useGrouping: true })}
          .stat-label Total Budget
    
    .dashboard-actions
      a.btn.btn-primary(href="/employer/post-job") Post New Job
      a.btn.btn-secondary(href="/employer/browse-craftsmen") Browse Craftsmen
      a.btn.btn-secondary(href="/employer/all-jobs") View All Job Postings
      a.btn.btn-secondary(href="/employer/payment-records") View Payment Records

    //- New Section for Reporting
    .dashboard-section.report-section
      h2 Report a Problem
      p If a craftsman did not perform well, you can report the issue directly to the administration.
      form(action="/employer/report-problem", method="POST")
        .form-group
          label(for="craftsmanName") Craftsman Name
          input.form-control(type="text", id="craftsmanName", name="craftsmanName", required)
        .form-group
          label(for="reportSubject") Subject
          input.form-control(type="text", id="reportSubject", name="reportSubject", required)
        .form-group
          label(for="reportMessage") Report Message
          textarea.form-control(id="reportMessage", name="reportMessage", rows="5", required)
        button.btn.btn-danger(type="submit") Submit Report
    
    .dashboard-section
      h2 Your Recent Jobs
      if jobs.length > 0
        .jobs-grid
          each job in jobs
            .job-card
              h3.job-title= job.title
              p.job-description= job.description
              .job-meta
                span.job-location üìç #{job.location}
                span.job-budget üí∞ UGX #{job.budget.toLocaleString('en-UG', { useGrouping: true })}
                span.job-status(class=`status-${job.status}`)= job.status
              .job-actions
                if job.status === 'open'
                  a.btn.btn-sm.btn-secondary(href=`/employer/applications/${job._id}`) View Applications
                else if job.status === 'in-progress'
                  a.btn.btn-sm.btn-primary(href=`/employer/deposit-funds/${job._id}`) Make Payment
                else if job.status === 'paid-in-escrow'
                  form(action=`/employer/release-funds/${job._id}`, method='POST', onsubmit="return confirm('Are you sure you want to release the funds to the craftsman? This action cannot be undone.');")
                    button.btn.btn-sm.btn-success(type='submit') Release Funds
                else if job.status === 'disbursed'
                  button.btn.btn-sm.btn-secondary(disabled) Funds Disbursed
      else
        .empty-state
          .empty-icon üìã
          h3 No Jobs Posted Yet
          p Start by posting your first job to connect with skilled craftsmen
          a.btn.btn-primary(href="/employer/post-job") Post Your First Job