//- D:\GENESIS\GENESIS-APP-CRAFTSMART\project\views\employer\dashboard.pug

extends ../layout

block content
  .container
    .dashboard-header
      h1.dashboard-title Welcome back, #{user.name}
      p.dashboard-subtitle Manage your projects and find skilled craftsmen
    
    .dashboard-stats
      .stat-card
        .stat-icon ğŸ“‹
        .stat-info
          .stat-number= jobs.length
          .stat-label Active Jobs
      .stat-card
        .stat-icon ğŸ‘¨â€ğŸ”§
        .stat-info
          .stat-number= craftsmen.length
          .stat-label Available Craftsmen
      .stat-card
        .stat-icon ğŸ’°
        .stat-info
          // Change the currency symbol and format the number for Ugandan Shillings
          .stat-number UGX #{jobs.reduce((sum, job) => sum + job.budget, 0).toLocaleString('en-UG', { useGrouping: true })}
          .stat-label Total Budget
    
    .dashboard-actions
      a.btn.btn-primary(href="/employer/post-job") Post New Job
      a.btn.btn-secondary(href="/employer/browse-craftsmen") Browse Craftsmen
      // The general "Make Payment" button is removed because payment is now job-specific.
      a.btn.btn-secondary(href="/employer/payment-records") View Payment Records
    
    .dashboard-section
      h2 Your Recent Jobs
      if jobs.length > 0
        .jobs-grid
          each job in jobs
            .job-card
              h3.job-title= job.title
              p.job-description= job.description
              .job-meta
                span.job-location ğŸ“ #{job.location}
                // Change the currency symbol and format the number
                span.job-budget ğŸ’° UGX #{job.budget.toLocaleString('en-UG', { useGrouping: true })}
                span.job-status(class=`status-${job.status}`)= job.status
              .job-actions
                if job.status === 'open'
                  // ğŸ’¡ Corrected: This button is now a working link to view applications
                  a.btn.btn-sm.btn-secondary(href=`/employer/applications/${job._id}`) View Applications
                else if job.status === 'in-progress'
                  // ğŸ’¡ Corrected: Link updated to match the new route for deposits
                  a.btn.btn-sm.btn-primary(href=`/employer/deposit-funds/${job._id}`) Make Payment
                else if job.paymentStatus === 'paid-in-escrow'
                  // ğŸ’¡ Corrected: This button is now a working link to disburse funds.
                  a.btn.btn-sm.btn-success(href=`/admin/payments/${job.transaction_id}`) Release Funds
                else if job.paymentStatus === 'disbursed'
                  button.btn.btn-sm.btn-secondary(disabled) Funds Disbursed
      else
        .empty-state
          .empty-icon ğŸ“‹
          h3 No Jobs Posted Yet
          p Start by posting your first job to connect with skilled craftsmen
          a.btn.btn-primary(href="/employer/post-job") Post Your First Job
