extends ../layout

block append head
  // Tailwind CSS
  link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css")
  // Font Awesome for icons
  link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css")

  style.
    .gradient-bg {
      background: linear-gradient(to right, #2563EB, #6366F1);
    }
    .card-shadow {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .btn-primary {
      background-color: #3b82f6;
      color: white;
      transition: background-color 0.3s ease;
    }
    .btn-primary:hover {
      background-color: #2563eb;
    }

block content
  .min-h-screen.bg-gray-50.py-8.px-4
    .max-w-2xl.mx-auto
      .bg-white.rounded-2xl.card-shadow.overflow-hidden
        // Header
        .gradient-bg.px-6.py-8.text-white.text-center
          i.fas.fa-receipt.text-4xl.mb-4
          h1.text-2xl.font-bold Payment Status
          p.text-blue-100 Transaction #{transaction.transaction_id.substring(0, 8)}...

        .p-6
          // Status Badge
          .text-center.mb-6
            case transaction.status
              when 'PENDING'
                .status-badge.bg-gray-100.text-gray-800
                  i.fas.fa-clock.mr-1
                  | Pending
              when 'PAYMENT_REQUESTED'
                .status-badge.bg-blue-100.text-blue-800
                  i.fas.fa-mobile-alt.mr-1
                  | Payment Requested
              when 'SUCCESSFUL'
                .status-badge.bg-green-100.text-green-800
                  i.fas.fa-check-circle.mr-1
                  | Payment Received
              when 'PAYMENT_FAILED'
                .status-badge.bg-red-100.text-red-800
                  i.fas.fa-times-circle.mr-1
                  | Payment Failed
              when 'DISBURSEMENT_INITIATED'
                .status-badge.bg-yellow-100.text-yellow-800
                  i.fas.fa-arrow-right.mr-1
                  | Disbursement Initiated
              when 'COMPLETED'
                .status-badge.bg-green-100.text-green-800
                  i.fas.fa-check-circle.mr-1
                  | Completed
              when 'DISBURSEMENT_FAILED'
                .status-badge.bg-red-100.text-red-800
                  i.fas.fa-exclamation-triangle.mr-1
                  | Disbursement Failed
              default
                .status-badge.bg-gray-100.text-gray-800
                  i.fas.fa-question.mr-1
                  | #{transaction.status}

          // Transaction Details
          .bg-gray-50.rounded-lg.p-6.mb-6
            h2.text-lg.font-semibold.text-gray-800.mb-4 Transaction Details
            .grid.grid-cols-1.md:grid-cols-2.gap-4.text-sm
              div
                span.font-medium.text-gray-600 Transaction ID:
                p.text-gray-900.font-mono= transaction.transaction_id
              div
                span.font-medium.text-gray-600 Case ID:
                p.text-gray-900 ##{transaction.case_id}
              div
                span.font-medium.text-gray-600 Total Amount:
                p.text-gray-900.font-semibold= formatCurrency(transaction.total_amount)
              div
                span.font-medium.text-gray-600 Commission (10%):
                p.text-gray-900= formatCurrency(transaction.commission_amount)
              div
                span.font-medium.text-gray-600 Craftsman Amount (90%):
                p.text-gray-900= formatCurrency(transaction.disbursement_amount)
              div
                span.font-medium.text-gray-600 Payment Method:
                p.text-gray-900.uppercase= transaction.payment_method
              div
                span.font-medium.text-gray-600 Employer Phone:
                p.text-gray-900= transaction.employer_phone
              div
                span.font-medium.text-gray-600 Craftsman Phone:
                p.text-gray-900= transaction.craftsman_phone
              div
                span.font-medium.text-gray-600 Created:
                p.text-gray-900= formatDate(transaction.created_at)
              div
                span.font-medium.text-gray-600 Last Updated:
                p.text-gray-900= formatDate(transaction.updated_at)

          // Payment Instructions
          if transaction.status === 'PAYMENT_REQUESTED'
            .bg-blue-50.border.border-blue-200.p-4.rounded-lg.mb-6
              .flex.items-start.space-x-3
                i.fas.fa-info-circle.text-blue-600.flex-shrink-0.mt-0.5
                div
                  h3.font-medium.text-blue-800 Payment Pending
                  p.text-sm.text-blue-700.mt-1
                    | Please check your phone for a mobile money prompt and approve the transaction. 
                    | The page will automatically update once payment is confirmed.

          // Activity Log
          if logs && logs.length > 0
            .bg-gray-50.rounded-lg.p-6
              h3.text-lg.font-semibold.text-gray-800.mb-4 Activity Log
              .space-y-3
                each log in logs
                  .flex.items-start.space-x-3.text-sm
                    case log.status
                      when 'SUCCESSFUL'
                        i.fas.fa-check-circle.text-green-500.flex-shrink-0.mt-0.5
                      when 'FAILED'
                        i.fas.fa-times-circle.text-red-500.flex-shrink-0.mt-0.5
                      default
                        i.fas.fa-circle.text-blue-500.flex-shrink-0.mt-0.5
                    div
                      p.font-medium.text-gray-900= log.action.replace(/_/g, ' ')
                      p.text-gray-600= formatDate(log.created_at)
                      if log.error_message
                        p.text-red-600.text-xs.mt-1= log.error_message

          // Actions
          .flex.flex-col.sm:flex-row.gap-4.mt-6
            a(href='/').flex.items-center.justify-center.px-6.py-3.bg-gray-100.text-gray-700.font-medium.rounded-lg.hover:bg-gray-200.transition-all
              i.fas.fa-home.mr-2
              | Back to Home
            a(href='/admin/dashboard').flex.items-center.justify-center.px-6.py-3.btn-primary.text-white.font-medium.rounded-lg
              i.fas.fa-chart-bar.mr-2
              | View Dashboard

block scripts
  script.
    // Auto-refresh page every 10 seconds if a transaction is in a pending state
    const transactionStatus = '#{transaction.status}';
    if (['PENDING', 'PAYMENT_REQUESTED', 'DISBURSEMENT_INITIATED'].includes(transactionStatus)) {
      setTimeout(() => {
        window.location.reload();
      }, 10000);
    }