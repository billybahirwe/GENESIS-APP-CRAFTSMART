extends layout

block content
  .auth-container
    .auth-card
      h2.auth-title Create Your CraftSmart Account

      if error
        .alert.alert-error= error

      form.auth-form(action="/register", method="POST")
        .form-row
          .form-col
            label(for="name") Full Name
            input.form-control(type="text", id="name", name="name", required, placeholder="Enter your full name")

          .form-col
            label(for="email") Email Address
            input.form-control(type="email", id="email", name="email", required, placeholder="Enter your email")

        .form-row
          .form-col
            label(for="mobile") Mobile Number
            input.form-control(type="tel", id="mobile", name="mobile", required, placeholder="Enter your mobile number")

          .form-col
            label(for="password") Password
            .password-wrapper
              input.form-control(type="password", id="password", name="password", required, placeholder="Choose a secure password")
              i.toggle-password.far.fa-eye

        // âœ… Confirm Password field added
        .form-row
          .form-col
            label(for="confirmPassword") Confirm Password
            .password-wrapper
              input.form-control(type="password", id="confirmPassword", name="confirmPassword", required, placeholder="Re-enter your password")
              i.toggle-password.far.fa-eye

        .form-group
          label(for="role") I am a:
          select.form-control(id="role", name="role", required)
            option(value="") Select your role
            option(value="employer") Employer (Looking to hire)
            option(value="craftsman") Craftsman (Looking for work)

        //- LOCATION SECTION (applies to both)
        .location-section
          .form-row
            .form-col
              label(for='region' class='block mb-1 font-semibold') Region
              select#region(name='region', required, class='form-control')
                option(value='') Select Region
                option(value='Central') Central
                option(value='Eastern') Eastern
                option(value='Northern') Northern
                option(value='Western') Western

            .form-col
              label(for='district' class='block mb-1 font-semibold') District
              select#district(name='district', required, class='form-control')
                option(value='') Select District

          .form-group
            label(for='city' class='block mb-1 font-semibold') City / Neighborhood
            select#city(name='city', required, class='form-control')
              option(value='') Select City / Neighborhood

        //- EMPLOYER FIELDS
        .employer-fields.hidden
          .form-group
            label(for="company" class="block mb-1 font-semibold") Company Name
            input(type="text", name="company", placeholder="Your company name", class="form-control")

          .form-group
            label(for="position" class="block mb-1 font-semibold") Position/Title
            input(type="text", name="position", placeholder="Your title", class="form-control")

          .form-group
            label(for="industry" class="block mb-1 font-semibold") Industry
            input(type="text", name="industry", placeholder="Construction, Design, etc.", class="form-control")

        //- CRAFTSMAN FIELDS
        .craftsman-fields.hidden
          .form-group
            label(for='skills' class='block mb-1 font-semibold') Skills (comma-separated)
            input#skills(type='text', name='skills', placeholder='e.g. plumbing, carpentry', class='form-control')

          .form-group
            label(for='bio' class='block mb-1 font-semibold') Bio
            textarea#bio(name='bio', rows='7', class='form-control')
              | Born: _______________
              | 
              | Gender: _______________
              | 
              | Languages: _______________
              | 
              | Years of Experience: _______________
              | 
              | About me: I am a highly skilled _______________ with over __ years of hands-on experience. 
              | I have worked on various projects including _______________. I take pride in delivering 
              | quality work and maintaining good communication with clients.

        button.btn-primary.btn-full(type="submit") Create Account

  //- JavaScript to handle form logic
  script.
    document.addEventListener('DOMContentLoaded', () => {
      const districts = {
        Central: { Kampala: ["Muyenga","Lweza","Kabalagala","Munyonyo","Ntinda","Naguru","Buziga","Bugolobi","Makindye","Kololo","Kansanga","Kyambogo","Rubaga","Nakawa","Bukoto","Kamwokya","Nsambya","Bweyogerere","Namugongo","Kasubi","Mutungo","Kireka","Mengo","Kikoni"], Wakiso: ["Entebbe","Kira","Nansana","Kasangati","Gayaza","Bulenga"], Mukono: ["Mukono Town","Seeta","Namilyango"] },
        Eastern: { Jinja: ["Bugembe","Mpumudde","Wanyange"], Mbale: ["Industrial","Wanale","Namakwekwe"], Tororo: ["Malaba","Mukuju"] },
        Northern: { Gulu: ["Pece","Layibi"], Lira: ["Ojwina","Adyel"], Arua: ["River Oli","Adumi"] },
        Western: { Mbarara: ["Kamukuzi","Kakoba"], Kabale: ["Central","Kigongi"], FortPortal: ["East Division","West Division"] }
      };

      const regionSelect = document.getElementById("region");
      const districtSelect = document.getElementById("district");
      const citySelect = document.getElementById("city");
      const roleSelect = document.getElementById("role");
      const employerFields = document.querySelector(".employer-fields");
      const craftsmanFields = document.querySelector(".craftsman-fields");

      function populateDistricts() {
        const region = regionSelect.value;
        districtSelect.innerHTML = '<option value="">Select District</option>';
        citySelect.innerHTML = '<option value="">Select City / Neighborhood</option>';
        if (region && districts[region]) {
          Object.keys(districts[region]).forEach(district => {
            const option = document.createElement("option");
            option.value = district;
            option.text = district;
            districtSelect.appendChild(option);
          });
        }
      }

      function populateCities() {
        const region = regionSelect.value;
        const district = districtSelect.value;
        citySelect.innerHTML = '<option value="">Select City / Neighborhood</option>';
        if (region && district && districts[region][district]) {
          districts[region][district].forEach(city => {
            const option = document.createElement("option");
            option.value = city;
            option.text = city;
            citySelect.appendChild(option);
          });
        }
      }
      
      function toggleRoleFields() {
        const role = roleSelect.value;
        employerFields.classList.add("hidden");
        craftsmanFields.classList.add("hidden");
        if (role === "employer") {
          employerFields.classList.remove("hidden");
        } else if (role === "craftsman") {
          craftsmanFields.classList.remove("hidden");
        }
      }

      // Password toggle logic
      const togglePassword = document.querySelectorAll('.toggle-password');
      togglePassword.forEach(t => {
        const input = t.previousElementSibling;
        t.addEventListener('click', () => {
          const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
          input.setAttribute('type', type);
          t.classList.toggle('fa-eye-slash');
        });
      });

      regionSelect.addEventListener('change', populateDistricts);
      districtSelect.addEventListener('change', populateCities);
      roleSelect.addEventListener('change', toggleRoleFields);

      if (regionSelect.value) populateDistricts();
      if (districtSelect.value) populateCities();
      if (roleSelect.value) toggleRoleFields();
    });
