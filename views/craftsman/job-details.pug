extends ../layout

block content
  // Link to the new CSS file
  link(rel="stylesheet", href="/css/job-details.css")

  .container
    // Job Details Section
    .job-details-container
      // Title, Location, Budget
      h1.job-title= job.title
      .job-meta
        span.job-location üìç #{job.location}
        span.job-budget üí∞ UGX #{job.budget.toLocaleString('en-UG', { useGrouping: true })}

      // Job Description and Details
      .job-section
        h2.section-title Description
        p.job-description= job.description

      // ‚úÖ UPDATED: Images Section with Gallery
      if job.images && job.images.length > 0
        .job-section
          h2.section-title Job Photos
          .image-gallery.row.g-3
            each image, index in job.images
              .col-auto
                a.gallery-thumbnail(href="#", data-bs-toggle="modal", data-bs-target="#imageModal", data-image-url=image)
                  img.img-fluid.rounded.job-image-thumbnail(src=image, alt=`Image ${index + 1} of ${job.title}`)

      // Apply for Job button
      .job-actions
        if user && user.role === 'craftsman'
          form(action=`/craftsman/apply-for-job/${job._id}`, method="POST")
            button.btn.btn-primary(type="submit") Apply for this Job
        else
          p.text-muted Log in as a craftsman to apply for this job.
  
  // Back button
  .back-link
    a(href="/craftsman/dashboard") ‚Üê Back to Jobs

  // ‚úÖ NEW: Bootstrap Modal for Image Zoom
  #imageModal.modal.fade(tabindex="-1", aria-labelledby="imageModalLabel", aria-hidden="true")
    .modal-dialog.modal-dialog-centered.modal-xl
      .modal-content
        .modal-body.p-0.text-center
          img.img-fluid#modalImage(src="", alt="Zoomed-in job image")
        .modal-footer.border-0
          button.btn.btn-secondary(type="button", data-bs-dismiss="modal") Close

  // ‚úÖ NEW: Script to handle the modal
  script.
    document.addEventListener("DOMContentLoaded", function () {
      const imageModal = document.getElementById("imageModal");
      imageModal.addEventListener("show.bs.modal", function (event) {
        const button = event.relatedTarget;
        const imageUrl = button.getAttribute("data-image-url");
        const modalImage = imageModal.querySelector("#modalImage");
        modalImage.src = imageUrl;
      });
    });