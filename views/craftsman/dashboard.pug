extends ../layout

block content
  .container
    .dashboard-header
      h1.dashboard-title Welcome back, #{user.name}
      if !user.approved
        .alert.alert-warning
          strong Profile Pending Approval
          p Your profile is under review. You'll be notified once approved.
      else
        p.dashboard-subtitle Find your next project and grow your business

    .dashboard-stats
      .stat-card
        .stat-icon üìã
        .stat-info
          .stat-number= availableJobs.length
          .stat-label Available Jobs
      .stat-card
        .stat-icon üî®
        .stat-info
          .stat-number= myJobs.length
          .stat-label My Jobs
      .stat-card
        .stat-icon ‚≠ê
        .stat-info
          .stat-number= user.rating || 'New'
          .stat-label Rating

    if user.approved
      .dashboard-section
        h2 Available Jobs
        if availableJobs.length > 0
          .jobs-grid
            each job in availableJobs
              .job-card
                h3.job-title= job.title
                p.job-description= job.description
                .job-meta
                  span.job-location üìç #{job.locationName}
                  // Display distance if available
                  if job.distanceKm
                    span.job-distance üõ£Ô∏è #{job.distanceKm.toFixed(1)} km away
                    // Far job warning using only CSS class
                    if job.isFar
                      span.job-warning
                        i.fas.fa-exclamation-triangle
                        | This job is far! Consider travel costs before applying
                  span.job-budget üí∞ UGX #{job.budget.toLocaleString('en-UG', { useGrouping: true })}
                  span.job-category üè∑Ô∏è #{job.category}
                .job-actions
                  form.inline-form(action=`/craftsman/apply-for-job/${job._id}`, method="POST")
                    button.btn.btn-primary.btn-sm(type="submit") Apply for Job
                  a.btn.btn-secondary.btn-sm(href=`/craftsman/jobs/${job._id}`) View Details
        else
          .empty-state
            .empty-icon üìã
            h3 No Available Jobs
            p Check back later for new opportunities

    if myJobs.length > 0
      .dashboard-section
        h2 My Active Jobs
        .jobs-grid
          each job in myJobs
            .job-card
              h3.job-title= job.title
              p.job-description= job.description
              .job-meta
                span.job-location üìç #{job.locationName}
                span.job-budget üí∞ UGX #{job.budget.toLocaleString('en-UG', { useGrouping: true })}
                span.job-status(class=`status-${job.status}`)= job.status
              .job-actions
                a.btn.btn-secondary.btn-sm(href=`/craftsman/jobs/${job._id}`) View Details
                if job.status === 'SUCCESSFUL'
                  p.payment-status.status-warning Employer has paid. Funds pending release.
                else if job.status === 'COMPLETED'
                  p.payment-status.status-success Funds received!
