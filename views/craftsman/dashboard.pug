//- D:\GENESIS\GENESIS-APP-CRAFTSMART\project\views\craftsman\dashboard.pug

extends ../layout

block content
  .container
    .dashboard-header
      h1.dashboard-title Welcome back, #{user.name}
      if !user.approved
        .alert.alert-warning
          strong Profile Pending Approval
          p Your profile is under review. You'll be notified once approved.
      else
        p.dashboard-subtitle Find your next project and grow your business
    
    .dashboard-stats
      .stat-card
        .stat-icon üìã
        .stat-info
          .stat-number= availableJobs.length
          .stat-label Available Jobs
      .stat-card
        .stat-icon üî®
        .stat-info
          .stat-number= myJobs.length
          .stat-label My Jobs
      .stat-card
        .stat-icon ‚≠ê
        .stat-info
          .stat-number= user.rating || 'New'
          .stat-label Rating
    
    if user.approved
      .dashboard-section
        h2 Available Jobs
        if availableJobs.length > 0
          .jobs-grid
            each job in availableJobs
              .job-card
                h3.job-title= job.title
                p.job-description= job.description
                .job-meta
                  span.job-location üìç #{job.location}
                  // Change from dollars to Ugandan Shillings
                  span.job-budget üí∞ UGX #{job.budget.toLocaleString('en-UG', { useGrouping: true })}
                  span.job-category üè∑Ô∏è #{job.category}
                .job-actions
                  form.inline-form(action=`/craftsman/apply-for-job/${job._id}`, method="POST")
                    button.btn.btn-primary.btn-sm(type="submit") Apply for Job
                  // This is now a link to a new page to view job details
                  a.btn.btn-secondary.btn-sm(href=`/craftsman/jobs/${job._id}`) View Details
        else
          .empty-state
            .empty-icon üìã
            h3 No Available Jobs
            p Check back later for new opportunities
    
    if myJobs.length > 0
      .dashboard-section
        h2 My Active Jobs
        .jobs-grid
          each job in myJobs
            .job-card
              h3.job-title= job.title
              p.job-description= job.description
              .job-meta
                span.job-location üìç #{job.location}
                // Change from dollars to Ugandan Shillings
                span.job-budget üí∞ UGX #{job.budget.toLocaleString('en-UG', { useGrouping: true })}
                span.job-status(class=`status-${job.status}`)= job.status
              .job-actions
                a.btn.btn-primary.btn-sm(href=`/craftsman/contact-employer/${job.employerId}`) Contact Employer
                a.btn.btn-secondary.btn-sm(href=`/craftsman/update-status/${job._id}`) Update Status
                if job.status === 'SUCCESSFUL'
                  p.payment-status(style='color: #FFC107; font-weight: bold;') Employer has paid. Funds pending release.
                else if job.status === 'COMPLETED'
                  p.payment-status(style='color: #4CAF50; font-weight: bold;') Funds received!
